<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Energy Monitor</title>
    <link rel="icon" type="image/svg+xml" href="plug_icon.svg" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="particles"></div>

    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1 class="title">‚ö° ESP ENERGY MONITOR ‚ö°</h1>
        <div class="subtitle">
          <span class="status-dot"></span>
          <span id="status-text">LIVE MONITORING</span>
        </div>
      </div>

      <!-- Data Display Section -->
      <div class="data-grid">
        <!-- Voltage Card -->
        <div class="data-card voltage-card">
          <div class="card-label">
            <span class="icon">‚ö°</span>
            <span>VOLTAGE</span>
          </div>
          <div class="card-value">
            <span class="volt-value" id="voltage">0.0</span>
            <span class="unit">V</span>
          </div>
          <div class="card-bar voltage-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Current Card -->
        <div class="data-card current-card">
          <div class="card-label">
            <span class="icon">üîå</span>
            <span>CURRENT</span>
          </div>
          <div class="card-value">
            <span class="amp-value" id="current">0.00</span>
            <span class="unit">A</span>
          </div>
          <div class="card-bar current-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Power Card -->
        <div class="data-card power-card">
          <div class="card-label">
            <span class="icon">üí°</span>
            <span>POWER</span>
          </div>
          <div class="card-value">
            <span class="watt-value" id="power">0.0</span>
            <span class="unit">W</span>
          </div>
          <div class="card-bar power-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Energy Card -->
        <div class="data-card energy-card">
          <div class="card-label">
            <span class="icon">üîã</span>
            <span>ENERGY</span>
          </div>
          <div class="card-value">
            <span class="kwh-value" id="energy">0.00</span>
            <span class="unit">kWh</span>
          </div>
          <div class="card-bar energy-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Power Factor Card -->
        <div class="data-card pf-card">
          <div class="card-label">
            <span class="icon">üìä</span>
            <span>POWER FACTOR</span>
          </div>
          <div class="card-value">
            <span class="pf-value" id="pf">0.00</span>
            <span class="unit">PF</span>
          </div>
          <div class="card-bar pf-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Frequency Card -->
        <div class="data-card frequency-card">
          <div class="card-label">
            <span class="icon">„Ä∞Ô∏è</span>
            <span>FREQUENCY</span>
          </div>
          <div class="card-value">
            <span class="hz-value" id="frequency">0.00</span>
            <span class="unit">Hz</span>
          </div>
          <div class="card-bar frequency-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Runtime Card -->
        <div class="data-card days-card">
          <div class="card-label">
            <span class="icon">üìÖ</span>
            <span>RUNTIME</span>
          </div>
          <div class="card-value">
            <span class="days-value" id="totalDays">0.0</span>
            <span class="unit">Days</span>
          </div>
          <div class="card-bar days-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>

        <!-- Uptime Card -->
        <div class="data-card uptime-card">
          <div class="card-label">
            <span class="icon">‚è±Ô∏è</span>
            <span>UPTIME</span>
          </div>
          <div class="card-value">
            <span class="hr-value" id="uptime">0.0</span>
            <span class="unit">Hrs</span>
          </div>
          <div class="card-bar uptime-bar">
            <div class="card-bar-fill"></div>
          </div>
        </div>
      </div>

      <!-- Firebase Setup Button -->
      <div class="firebase-setup-container">
        <button class="btn-firebase-setup" onclick="goToFirebaseSetup()">
          üî• FIREBASE SETUP
        </button>
      </div>

      <!-- Footer -->
      <div class="footer">
        <div>
          ESP32 Real-time Energy Monitor Dashboard | Developer ¬© M.Maity
        </div>
        <div class="last-update">
          Last Update: <span id="last-update"> --- </span>
        </div>
      </div>
    </div>

    <script>
      function updateBar(selector, percentage) {
        const bar = document.querySelector(selector + " .card-bar-fill");
        if (bar) {
          bar.style.width = Math.min(Math.max(percentage, 0), 100) + "%";
        }
      }

      function updateSensorValues() {
        fetch("/sensor.json")
          .then((response) => response.json())
          .then((data) => {
            // Update values
            document.getElementById("voltage").textContent = parseFloat(
              data.voltage || 0
            ).toFixed(1);
            document.getElementById("current").textContent = parseFloat(
              data.current || 0
            ).toFixed(2);
            document.getElementById("power").textContent = parseFloat(
              data.power || 0
            ).toFixed(1);
            document.getElementById("energy").textContent = parseFloat(
              data.energy || 0
            ).toFixed(2);
            document.getElementById("pf").textContent = parseFloat(
              data.pf || 0
            ).toFixed(2);
            document.getElementById("frequency").textContent = parseFloat(
              data.frequency || 0
            ).toFixed(2);
            document.getElementById("totalDays").textContent = parseFloat(
              data.days || 0
            ).toFixed(1);
            document.getElementById("uptime").textContent = parseFloat(
              data.uptime || 0
            ).toFixed(1);

            // Update progress bars
            updateBar(".voltage-bar", (parseFloat(data.voltage) / 300) * 100);
            updateBar(".current-bar", (parseFloat(data.current) / 30) * 100);
            updateBar(".power-bar", (parseFloat(data.power) / 5000) * 100);
            updateBar(".energy-bar", (parseFloat(data.energy) / 500) * 100);
            updateBar(
              ".frequency-bar",
              ((parseFloat(data.frequency) - 48) / 4) * 100
            );
            updateBar(".pf-bar", parseFloat(data.pf) * 100);
            updateBar(".days-bar", (parseFloat(data.days) / 90) * 100);
            updateBar(".uptime-bar", (parseFloat(data.uptime) / 24) * 100);

            updateTimestamp();
          })
          .catch((error) => console.error("Error:", error));
      }

      function updateTimestamp() {
        const now = new Date();
        const timeStr = now.toLocaleString("en-IN", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: false,
        });
        document.getElementById("last-update").textContent = timeStr;
      }

      function createParticles() {
        const container = document.querySelector(".particles");
        if (!container) return;

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 5 + "s";
          particle.style.animationDuration = Math.random() * 3 + 5 + "s";
          container.appendChild(particle);
        }
      }

      function goToFirebaseSetup() {
        window.location.href = "/firebase";
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        createParticles();
        updateSensorValues();
        setInterval(updateSensorValues, 1000); // Update every second
      });
    </script>
  </body>
</html>
